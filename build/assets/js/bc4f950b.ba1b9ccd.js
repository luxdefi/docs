"use strict";(self.webpackChunklux_docs=self.webpackChunklux_docs||[]).push([[2178],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=o.createContext({}),s=function(e){var t=o.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=s(e.components);return o.createElement(u.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,h=d["".concat(u,".").concat(m)]||d[m]||p[m]||i;return n?o.createElement(h,r(r({ref:t},c),{},{components:n})):o.createElement(h,r({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=d;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:a,r[1]=l;for(var s=2;s<i;s++)r[s]=n[s];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},306:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return u},default:function(){return m},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return p}});var o=n(7462),a=n(3366),i=(n(7294),n(3905)),r=["components"],l={description:"GCP Validator Provisioning",sidebar_position:5},u="Run an Lux Node with Google Cloud Platform",s={unversionedId:"nodes/build/set-up-an-lux-node-with-google-cloud-platform",id:"nodes/build/set-up-an-lux-node-with-google-cloud-platform",title:"Run an Lux Node with Google Cloud Platform",description:"GCP Validator Provisioning",source:"@site/docs/nodes/build/set-up-an-lux-node-with-google-cloud-platform.md",sourceDirName:"nodes/build",slug:"/nodes/build/set-up-an-lux-node-with-google-cloud-platform",permalink:"/nodes/build/set-up-an-lux-node-with-google-cloud-platform",draft:!1,editUrl:"https://github.com/luxdefi/network-docs/edit/main/docs/nodes/build/set-up-an-lux-node-with-google-cloud-platform.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{description:"GCP Validator Provisioning",sidebar_position:5},sidebar:"nodes",previous:{title:"Run an Lux Node with Microsoft Azure",permalink:"/nodes/build/set-up-an-lux-node-with-microsoft-azure"},next:{title:"Node Backup and Restore",permalink:"/nodes/maintain/node-backup-and-restore"}},c={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Conventions",id:"conventions",level:2},{value:"Important Notes",id:"important-notes",level:2},{value:"Architectural Description",id:"architectural-description",level:2},{value:"Project",id:"project",level:3},{value:"Service Enablement",id:"service-enablement",level:4},{value:"Networking",id:"networking",level:3},{value:"Compute Network",id:"compute-network",level:4},{value:"Public IP",id:"public-ip",level:4},{value:"Subnets",id:"subnets",level:4},{value:"Compute",id:"compute",level:3},{value:"Disk",id:"disk",level:4},{value:"Instance",id:"instance",level:4},{value:"Zone",id:"zone",level:4},{value:"Firewall",id:"firewall",level:4},{value:'<a name="setup-instructions"></a> Setup Instructions',id:"-setup-instructions",level:2},{value:"GCP Account",id:"gcp-account",level:3},{value:"Project",id:"project-1",level:3},{value:"Terraform State",id:"terraform-state",level:3},{value:"Clone Github Repository",id:"clone-github-repository",level:3},{value:"Terraform Configuration",id:"terraform-configuration",level:3},{value:"Terraform Execution",id:"terraform-execution",level:3},{value:"Plan",id:"plan",level:4},{value:"Apply",id:"apply",level:4},{value:"Conclusion",id:"conclusion",level:2}],d={toc:p};function m(e){var t=e.components,l=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"run-an-lux-node-with-google-cloud-platform"},"Run an Lux Node with Google Cloud Platform"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"This document was written by a community member, some information may be out of dated.")),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"Google's Cloud Platform (GCP) is a scalable, trusted and reliable hosting platform. Google operates a significant amount of it's own global networking infrastructure. It's ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.google.com/blog/products/networking/google-cloud-networking-in-depth-cloud-cdn"},"fiber network")," is ",(0,i.kt)("strong",{parentName:"p"},"huge")," and it can provide highly stable and consistent global connectivity.\nIn this article we will leverage GCP to deploy a node on which Lux can installed via ",(0,i.kt)("a",{parentName:"p",href:"https://www.terraform.io/"},"terraform"),".\nLeveraging ",(0,i.kt)("inlineCode",{parentName:"p"},"terraform")," may seem like overkill, but speaking as someone who has managed extremely large compute estates for over a decade I believe it will set you apart as an operator and administrator as it will enable you greater flexibility and provide the basis on which you can easily build further automation."),(0,i.kt)("h2",{id:"conventions"},"Conventions"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Items")," highlighted in this manor are GCP parlance and can be searched for further reference in the Google documentation for their cloud products.")),(0,i.kt)("h2",{id:"important-notes"},"Important Notes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The machine type used in this documentation is for reference only and the actual sizing you use will depend entirely upon the amount that is staked and delegated to the node.")),(0,i.kt)("h2",{id:"architectural-description"},"Architectural Description"),(0,i.kt)("p",null,"This section aims to describe the architecture of the system that the steps in the ",(0,i.kt)("a",{parentName:"p",href:"#setup-instructions"},"Setup Instructions")," section deploy when enacted. This is done so that the executor can not only deploy the reference architecture, but also understand and potentially optimize it for their needs."),(0,i.kt)("h3",{id:"project"},"Project"),(0,i.kt)("p",null,"We will create and utilize a single GCP ",(0,i.kt)("inlineCode",{parentName:"p"},"Project")," for deployment of all resources."),(0,i.kt)("h4",{id:"service-enablement"},"Service Enablement"),(0,i.kt)("p",null,"Within our GCP project we will need to enable the following Cloud Services:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Compute Engine")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"IAP"))),(0,i.kt)("h3",{id:"networking"},"Networking"),(0,i.kt)("h4",{id:"compute-network"},"Compute Network"),(0,i.kt)("p",null,"We will deploy a single ",(0,i.kt)("inlineCode",{parentName:"p"},"Compute Network")," object. This unit is where we will deploy all subsequent networking objects. It provides a logical boundary and securitization context should you wish to deploy other chain stacks or other infrastructure in GCP."),(0,i.kt)("h4",{id:"public-ip"},"Public IP"),(0,i.kt)("p",null,"Lux requires that a validator communicate outbound on the same public IP address that it advertizes for other peers to connect to it on. Within GCP this precludes the possibility of us using a Cloud NAT Router for the outbound communications and requires us to bind the public IP that we provision to the interface of the machine. We will provision a single ",(0,i.kt)("inlineCode",{parentName:"p"},"EXTERNAL")," static IPv4 ",(0,i.kt)("inlineCode",{parentName:"p"},"Compute Address"),"."),(0,i.kt)("h4",{id:"subnets"},"Subnets"),(0,i.kt)("p",null,"For the purposes of this documentation we will deploy a single ",(0,i.kt)("inlineCode",{parentName:"p"},"Compute Subnetwork")," in the US-EAST1 ",(0,i.kt)("inlineCode",{parentName:"p"},"Region")," with a /24 address range giving us 254 IP addresses (not all usable but for the sake of generalized documentation)."),(0,i.kt)("h3",{id:"compute"},"Compute"),(0,i.kt)("h4",{id:"disk"},"Disk"),(0,i.kt)("p",null,"We will provision a single 400GB ",(0,i.kt)("inlineCode",{parentName:"p"},"PD-SSD")," disk that will be attached to our VM."),(0,i.kt)("h4",{id:"instance"},"Instance"),(0,i.kt)("p",null,"We will deploy a single ",(0,i.kt)("inlineCode",{parentName:"p"},"Compute Instance")," of size ",(0,i.kt)("inlineCode",{parentName:"p"},"e2-standard-8"),". Observations of operations using this machine specification suggest it is memory over provisioned and could be brought down to 16GB using custom machine specification; but please review and adjust as needed (the beauty of compute virtualization!!)."),(0,i.kt)("h4",{id:"zone"},"Zone"),(0,i.kt)("p",null,"We will deploy our instance into the ",(0,i.kt)("inlineCode",{parentName:"p"},"US-EAST1-B")," ",(0,i.kt)("inlineCode",{parentName:"p"},"Zone")),(0,i.kt)("h4",{id:"firewall"},"Firewall"),(0,i.kt)("p",null,"We will provision the following ",(0,i.kt)("inlineCode",{parentName:"p"},"Compute Firewall")," rules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"IAP INGRESS for SSH (TCP 22) - this only allows GCP IAP sources inbound on SSH."),(0,i.kt)("li",{parentName:"ul"},"P2P INGRESS for LUX Peers (TCP 9651)")),(0,i.kt)("p",null,"These are obviously just default ports and can be tailored to your needs as you desire."),(0,i.kt)("h2",{id:"-setup-instructions"},(0,i.kt)("a",{name:"setup-instructions"})," Setup Instructions"),(0,i.kt)("h3",{id:"gcp-account"},"GCP Account"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If you don't already have a GCP account go create one ",(0,i.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/freetrial"},"here"))),(0,i.kt)("p",null,"You will get some free bucks to run a trial, the trial is feature complete but your usage will start to deplete your free bucks so turn off anything you don't need and/or add a credit card to your account if you intend to run things long term to avoid service shutdowns."),(0,i.kt)("h3",{id:"project-1"},"Project"),(0,i.kt)("p",null,"Login to the GCP ",(0,i.kt)("inlineCode",{parentName:"p"},"Cloud Console")," and create a new ",(0,i.kt)("inlineCode",{parentName:"p"},"Project")," in your organization. Let's use the name ",(0,i.kt)("inlineCode",{parentName:"p"},"my-lux-nodes")," for the sake of this setup."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("img",{alt:"Select Project Dropdown",src:n(1300).Z,width:"833",height:"182"})),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("img",{alt:"Click New Project Button",src:n(4180).Z,width:"788",height:"237"})),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("img",{alt:"Create New Project",src:n(1451).Z,width:"604",height:"480"}))),(0,i.kt)("h3",{id:"terraform-state"},"Terraform State"),(0,i.kt)("p",null,"Terraform uses a state file(s) to compose a differential between current infrastructure configuration and the proposed plan. You can store this state in a variety of different places, but using GCP storage is a reasonable approach given where we are deploying so we will stick with that."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("img",{alt:"Select Cloud Storage Browser",src:n(9578).Z,width:"525",height:"287"})),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("img",{alt:"Create New Bucket",src:n(4139).Z,width:"679",height:"158"}))),(0,i.kt)("p",null,"Authentication to GCP from terraform has a few different options which are layed out ",(0,i.kt)("a",{parentName:"p",href:"https://www.terraform.io/language/settings/backends/gcs"},"here"),". Please chose the option that aligns with your context and ensure those steps are completed before continuing."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Depending upon how you intend to execute your terraform operations you may or may not need to enable public access to the bucket. Obviously, not exposing the bucket for ",(0,i.kt)("inlineCode",{parentName:"p"},"public")," access (even if authenticated) is preferable. If you intend to simply run terraform commands from your local machine then you will need to open the access up.\nI recommend to employ a full CI/CD pipeline using GCP Cloud Build which if utilized will mean the bucket can be marked as ",(0,i.kt)("inlineCode",{parentName:"p"},"private"),". A full walkthrough of Cloud Build setup in this context can be found ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.google.com/architecture/managing-infrastructure-as-code"},"here"))),(0,i.kt)("h3",{id:"clone-github-repository"},"Clone Github Repository"),(0,i.kt)("p",null,"I have provided a rudimentary terraform construct to provision a node on which to run Lux which can be found ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/luxdefi/lux-docs/tree/master/static/scripts/terraform-gcp/projects/my-lux-project"},"here"),".\nDocumentation below assumes you are using this repository but if you have another terraform skelaton similar steps will apply."),(0,i.kt)("h3",{id:"terraform-configuration"},"Terraform Configuration"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"If running terraform locally, please ",(0,i.kt)("a",{parentName:"li",href:"https://learn.hashicorp.com/tutorials/terraform/install-cli"},"install")," it."),(0,i.kt)("li",{parentName:"ol"},"In this repository, navigate to the ",(0,i.kt)("inlineCode",{parentName:"li"},"terraform")," directory."),(0,i.kt)("li",{parentName:"ol"},"Under the ",(0,i.kt)("inlineCode",{parentName:"li"},"projects")," directory, rename the ",(0,i.kt)("inlineCode",{parentName:"li"},"my-lux-project")," directory to match your GCP project name that you created (not required, but nice to be consistent)"),(0,i.kt)("li",{parentName:"ol"},"Under the folder you just renamed locate the ",(0,i.kt)("inlineCode",{parentName:"li"},"terraform.tfvars")," file."),(0,i.kt)("li",{parentName:"ol"},"Edit this file and populate it with the values which make sense for your context and save it."),(0,i.kt)("li",{parentName:"ol"},"Locate the ",(0,i.kt)("inlineCode",{parentName:"li"},"backend.tf")," file in the same directory."),(0,i.kt)("li",{parentName:"ol"},"Edit this file ensuring to replace the ",(0,i.kt)("inlineCode",{parentName:"li"},"bucket")," property with the GCS bucket name that you created earlier.")),(0,i.kt)("p",null,"If you do not with to use cloud storage to persist terraform state then simply switch the ",(0,i.kt)("inlineCode",{parentName:"p"},"backend")," to some other desirable provider."),(0,i.kt)("h3",{id:"terraform-execution"},"Terraform Execution"),(0,i.kt)("p",null,"Terraform enables us to see what it would do if we were to run it without actually applying any changes... this is called a ",(0,i.kt)("inlineCode",{parentName:"p"},"plan")," operation. This plan is then enacted (optionally) by an ",(0,i.kt)("inlineCode",{parentName:"p"},"apply"),"."),(0,i.kt)("h4",{id:"plan"},"Plan"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In a terminal which is able to execute the ",(0,i.kt)("inlineCode",{parentName:"li"},"tf")," binary, ",(0,i.kt)("inlineCode",{parentName:"li"},"cd")," to the ~",(0,i.kt)("inlineCode",{parentName:"li"},"my-lux-project")," directory that you renamed in step 3 of ",(0,i.kt)("inlineCode",{parentName:"li"},"Terraform Configuration"),"."),(0,i.kt)("li",{parentName:"ol"},"Execute the command ",(0,i.kt)("inlineCode",{parentName:"li"},"tf plan")),(0,i.kt)("li",{parentName:"ol"},"You should see a JSON output to the stdout of the terminal which lays out the operations that terraform will execute to apply the intended state.")),(0,i.kt)("h4",{id:"apply"},"Apply"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In a terminal which is able to execute the ",(0,i.kt)("inlineCode",{parentName:"li"},"tf")," binary, ",(0,i.kt)("inlineCode",{parentName:"li"},"cd")," to the ~",(0,i.kt)("inlineCode",{parentName:"li"},"my-lux-project")," directory that you renamed in step 3 of ",(0,i.kt)("inlineCode",{parentName:"li"},"Terraform Configuration"),"."),(0,i.kt)("li",{parentName:"ol"},"Execute the command ",(0,i.kt)("inlineCode",{parentName:"li"},"tf apply"))),(0,i.kt)("p",null,"If you want to ensure that terraform does ",(0,i.kt)("strong",{parentName:"p"},"exactly")," what you saw in the ",(0,i.kt)("inlineCode",{parentName:"p"},"apply")," output, you can optionally request for the the ",(0,i.kt)("inlineCode",{parentName:"p"},"plan")," output to be saved to a file to feed to ",(0,i.kt)("inlineCode",{parentName:"p"},"apply"),". This is generally considered best practice in highly fluid environments where rapid change is occurring from multiple sources."),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"Establishing CI/CD practices using tools such as Github and Terraform to manage your infrastructure assets is a great way to ensure base disaster recovery capabilities and to ensure you have a place to embed any ~tweaks you have to make operationally removing the potential to miss them when you have to scale from 1 node to 10.\nHaving an automated pipeline also gives you a place to build a bigger house... what starts as your interest in building and managing a single LUX node today can quickly change into you building an infrastructure operation for many different chains working with multiple different team members. I hope this may have inspired you to take a leap into automation in this context!"))}m.isMDXComponent=!0},1451:function(e,t,n){t.Z=n.p+"assets/images/cloud_console_create_new_project-1356151586e6ff0bc43c8a08f739155c.png"},4180:function(e,t,n){t.Z=n.p+"assets/images/cloud_console_new_project_button-e015158a5a636496099b6a0d921d7de2.png"},1300:function(e,t,n){t.Z=n.p+"assets/images/cloud_console_project_dropdown-8bfff56a717f36ae5c6676a1f8090975.png"},9578:function(e,t,n){t.Z=n.p+"assets/images/cloud_storage_browser-6b8377d8b35ee73f84a73ad1d66c30f5.png"},4139:function(e,t,n){t.Z=n.p+"assets/images/cloud_storage_create_bucket-467caf63bb82f2453fbc66e6c5fbac1c.png"}}]);