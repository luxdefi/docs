"use strict";(self.webpackChunklux_docs=self.webpackChunklux_docs||[]).push([[1659],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return h}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),u=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=u(e.components);return a.createElement(l.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},p=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=u(t),h=i,m=p["".concat(l,".").concat(h)]||p[h]||c[h]||o;return t?a.createElement(m,r(r({ref:n},d),{},{components:t})):a.createElement(m,r({ref:n},d))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=p;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var u=2;u<o;u++)r[u]=t[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}p.displayName="MDXCreateElement"},5459:function(e,n,t){t.r(n),t.d(n,{assets:function(){return d},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return c}});var a=t(7462),i=t(3366),o=(t(7294),t(3905)),r=["components"],s={},l="Deploying Subnet with EVM Based Blockchain using LuxJS",u={unversionedId:"subnets/create-a-evm-blockchain-on-subnet-with-luxjs",id:"subnets/create-a-evm-blockchain-on-subnet-with-luxjs",title:"Deploying Subnet with EVM Based Blockchain using LuxJS",description:"Introduction",source:"@site/docs/subnets/create-a-evm-blockchain-on-subnet-with-luxjs.md",sourceDirName:"subnets",slug:"/subnets/create-a-evm-blockchain-on-subnet-with-luxjs",permalink:"/subnets/create-a-evm-blockchain-on-subnet-with-luxjs",draft:!1,editUrl:"https://github.com/luxdefi/network-docs/edit/main/docs/subnets/create-a-evm-blockchain-on-subnet-with-luxjs.md",tags:[],version:"current",frontMatter:{},sidebar:"subnets",previous:{title:"Deploy a Smart Contract on Your Subnet EVM Using Remix and Metamask",permalink:"/subnets/deploy-a-smart-contract-on-your-evm"},next:{title:"Create an EVM Subnet on Fuji Testnet Using Subnet-CLI",permalink:"/subnets/create-a-fuji-subnet-subnet-cli"}},d={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Project structure",id:"project-structure",level:2},{value:"Setting up LuxGo and Subnet EVM Binaries",id:"setting-up-luxgo-and-subnet-evm-binaries",level:2},{value:"Clone LuxGo Repository",id:"clone-luxgo-repository",level:3},{value:"Build Binary",id:"build-binary",level:3},{value:"Clone Subnet-EVM Repository",id:"clone-subnet-evm-repository",level:3},{value:"Build Binary and Copy it to LuxGo Plugins",id:"build-binary-and-copy-it-to-luxgo-plugins",level:3},{value:"Setting up Local Lux Network",id:"setting-up-local-lux-network",level:2},{value:"Clone Lux Network Runner",id:"clone-lux-network-runner",level:3},{value:"Install ANR binary",id:"install-anr-binary",level:3},{value:"Start RPC Server",id:"start-rpc-server",level:3},{value:"Start 5 Node Cluster",id:"start-5-node-cluster",level:3},{value:"Setting up Node.js Project",id:"setting-up-nodejs-project",level:2},{value:"Installing dependencies",id:"installing-dependencies",level:3},{value:"Configuration and other details",id:"configuration-and-other-details",level:3},{value:"Import Libraries and Setup Instances for Lux APIs",id:"import-libraries-and-setup-instances-for-lux-apis",level:3},{value:"Genesis Data",id:"genesis-data",level:3},{value:"Creating Subnet",id:"creating-subnet",level:2},{value:"Adding Subnet Validator",id:"adding-subnet-validator",level:2},{value:"Whitelisting Subnet from the Node",id:"whitelisting-subnet-from-the-node",level:2},{value:"Creating Blockchain",id:"creating-blockchain",level:2},{value:"Importing Dependencies",id:"importing-dependencies",level:3},{value:"Decoding CB58 <code>vmID</code> to String",id:"decoding-cb58-vmid-to-string",level:3},{value:"Creating Blockchain",id:"creating-blockchain-1",level:3},{value:"Interacting with the New Blockchain with MetaMask",id:"interacting-with-the-new-blockchain-with-metamask",level:2}],p={toc:c};function h(e){var n=e.components,t=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"deploying-subnet-with-evm-based-blockchain-using-luxjs"},"Deploying Subnet with EVM Based Blockchain using LuxJS"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"A blockchain is an instance of ",(0,o.kt)("strong",{parentName:"p"},"Virtual Machine (VM)")," that processes transactions to change the genesis (base) and the subsequent states. VMs define blockchain\u2019s state, state transition function, transactions, and the API through which users can interact with the blockchain. On Lux, VM serves as the blueprint for creating different instances of independent blockchains, yet sharing the same ruleset."),(0,o.kt)("p",null,"All transactions on a blockchain need to be validated by the validators. ",(0,o.kt)("strong",{parentName:"p"},"Subnets")," are the group of validators that can validate one or many chains. On Lux, the primary Subnet, that currently validates 3 blockchains, and each chain serves a different purpose. One can easily deploy their Subnet and invite other validators to be a part of it. A validator can be a part of multiple Subnets, but it must be validating the primary Subnet."),(0,o.kt)("p",null,"On Lux, out of the 3 chains, ",(0,o.kt)("strong",{parentName:"p"},"Platform Chain")," (P-Chain) manages Subnets, Subnet validators, Subnet blockchain, etc. In this tutorial, you will learn about creating your Subnet and deploying ",(0,o.kt)("strong",{parentName:"p"},"Ethereum Virtual Machine (EVM)")," based blockchain on that Subnet through your Node.js application using ",(0,o.kt)("strong",{parentName:"p"},"LuxJS"),". LuxJS is a javascript library that allows you to issue commands to the Lux node APIs without worrying about transaction serialization, signing it with the keys etc. On our ",(0,o.kt)("a",{parentName:"p",href:"/subnets/"},"Subnet series of tutorials"),", you can get various great articles explaining Subnets, building custom VMs, and a lot more."),(0,o.kt)("h2",{id:"requirements"},"Requirements"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://golang.org/doc/install"},"Go")," version >= 1.17.9"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://nodejs.org/en"},"NodeJS")," Node >= 10.16 and npm >= 5.6")),(0,o.kt)("h2",{id:"project-structure"},"Project structure"),(0,o.kt)("p",null,"Open the terminal and make a new directory at your desired location. We will keep all the binaries and other codes in this folder."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir subnet-evm-demo\ncd subnet-evm-demo\n")),(0,o.kt)("h2",{id:"setting-up-luxgo-and-subnet-evm-binaries"},"Setting up LuxGo and Subnet EVM Binaries"),(0,o.kt)("p",null,"Clients interact with Lux blockchain by issuing API calls to the nodes running ",(0,o.kt)("inlineCode",{parentName:"p"},"LuxGo"),". We have to clone the repository, build its binary, and run it. If we want to deploy our blockchain, we have to put the blockchain's VM binary inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"build/plugins")," directory. Here we will also clone the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm")," repository, build the VM's binary, and copy it to the LuxGo's ",(0,o.kt)("inlineCode",{parentName:"p"},"build/plugins")," directory. Follow the steps below -"),(0,o.kt)("h3",{id:"clone-luxgo-repository"},"Clone LuxGo Repository"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/luxdefi/luxd\ncd luxd\n")),(0,o.kt)("h3",{id:"build-binary"},"Build Binary"),(0,o.kt)("p",null,"Running the below command will create an ",(0,o.kt)("inlineCode",{parentName:"p"},"luxd")," binary inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"build/")," directory and will install the coreth ",(0,o.kt)("inlineCode",{parentName:"p"},"evm")," binary inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"build/plugins")," directory. For more information on running a node, please refer ",(0,o.kt)("a",{parentName:"p",href:"/nodes/build/run-lux-node-manually"},"this"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./scripts/build.sh\n")),(0,o.kt)("h3",{id:"clone-subnet-evm-repository"},"Clone Subnet-EVM Repository"),(0,o.kt)("p",null,"Move to the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm-demo")," directory, and clone the repo."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/luxdefi/subnet-evm\ncd subnet-evm\n")),(0,o.kt)("h3",{id:"build-binary-and-copy-it-to-luxgo-plugins"},"Build Binary and Copy it to LuxGo Plugins"),(0,o.kt)("p",null,"Now run the following command to build the VM's binary inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"build/")," directory, named as ",(0,o.kt)("inlineCode",{parentName:"p"},"srEXiWaHuhNyGwPUi444Tu47ZEDwxTWrbQiuD7FmgSAQ6X7Dy"),'. It is the id for this VM and corresponds to the string "',(0,o.kt)("strong",{parentName:"p"},"subnetevm"),"\" zero-extended in a 32-byte array and encoded in CB58. Then copy it to LuxGo's ",(0,o.kt)("inlineCode",{parentName:"p"},"build/plugins")," directory."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"./scripts/build.sh build/srEXiWaHuhNyGwPUi444Tu47ZEDwxTWrbQiuD7FmgSAQ6X7Dy\n\ncp build/srEXiWaHuhNyGwPUi444Tu47ZEDwxTWrbQiuD7FmgSAQ6X7Dy ../luxd/build/plugins\n")),(0,o.kt)("p",null,"You can directly build the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm")," binary inside the plugins folder as well, by passing its location as the argument."),(0,o.kt)("h2",{id:"setting-up-local-lux-network"},"Setting up Local Lux Network"),(0,o.kt)("p",null,"For the development purpose, we can use ",(0,o.kt)("a",{parentName:"p",href:"/subnets/network-runner"},(0,o.kt)("strong",{parentName:"a"},"Lux Network Runner (ANR)")),". It helps us in simulating the actual network. For this tutorial, we will be installing ANR binary and will interact with the network through RPCs."),(0,o.kt)("h3",{id:"clone-lux-network-runner"},"Clone Lux Network Runner"),(0,o.kt)("p",null,"Now move to ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm-demo"),", and clone the repository."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/luxdefi/lux-network-runner\ncd lux-network-runner\n")),(0,o.kt)("h3",{id:"install-anr-binary"},"Install ANR binary"),(0,o.kt)("p",null,"The following command will install the ANR binary inside ",(0,o.kt)("inlineCode",{parentName:"p"},"$GOPATH/bin"),". Please make sure that you have the ",(0,o.kt)("inlineCode",{parentName:"p"},"$GOPATH/bin")," path set in the ",(0,o.kt)("inlineCode",{parentName:"p"},"$PATH")," environment variable, otherwise, you will not be able to run the binary unless you specify its location in each command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"go install -v ./cmd/lux-network-runner\n")),(0,o.kt)("h3",{id:"start-rpc-server"},"Start RPC Server"),(0,o.kt)("p",null,"Run the following command to start the RPC server. This will help us in deploying our local cluster of validating nodes. Keep this tab open and run the subsequent commands in the new terminal (or tab)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'lux-network-runner server \\\n--port=":8080" \\\n--grpc-gateway-port=":8081"\n')),(0,o.kt)("h3",{id:"start-5-node-cluster"},"Start 5 Node Cluster"),(0,o.kt)("p",null,"Run the following command to start a network cluster of 5 validating nodes, all running the LuxGo's binary and have the plugins of the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm")," VM. Put the ",(0,o.kt)("inlineCode",{parentName:"p"},"luxd")," binary location as per your requirement."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'lux-network-runner control start \\\n--endpoint="0.0.0.0:8080" \\\n--luxd-path ${HOME}/subnet-evm-demo/luxd/build/luxd\n')),(0,o.kt)("p",null,"You can see how the network is set up, and finally the node information at last (within 10-15 seconds), by viewing the logs in the previous tab. Now you have the local simulation of the Lux network, with 5 validating nodes."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'node1: node ID "NodeID-7Xhw2mDxuDS44j42TCB6U5579esbSt3Lg", URI "http://localhost:48607"\nnode2: node ID "NodeID-MFrZFVCXPv5iCn6M9K6XduxGTYp891xXZ", URI "http://localhost:27236"\nnode3: node ID "NodeID-NFBbbJ4qCmNaCzeW7sxErhvWqvEQMnYcN", URI "http://localhost:58800"\nnode4: node ID "NodeID-GWPcbFJZFfZreETSoWjPimr846mXEKCtu", URI "http://localhost:65011"\nnode5: node ID "NodeID-P7oB2McjBGgW2NXXWVYjV8JEDFoW9xDE5", URI "http://localhost:12023"\n')),(0,o.kt)("p",null,"You can view the ",(0,o.kt)("inlineCode",{parentName:"p"},"URIs")," of the nodes using the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'lux-network-runner control uris \\\n--endpoint="0.0.0.0:8080"\n')),(0,o.kt)("p",null,"For the demonstration purpose, let us choose ",(0,o.kt)("inlineCode",{parentName:"p"},"node1")," as our subject node for making requests and finally making it a validator on our Subnet. Make sure to copy its ",(0,o.kt)("inlineCode",{parentName:"p"},"URI")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"PORT"),", as we will need that later."),(0,o.kt)("p",null,"ANR also provides us with the funded account with the following credentials."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"P-Chain Address 1:     P-custom18jma8ppw3nhx5r4ap8clazz0dps7rv5u9xde7p\nP-Chain Address 1 Key: PrivateKey-ewoqjP7PxY4yr3iLTpLisriqt94hdyDFNgchSxGGztUrTXtNN\n")),(0,o.kt)("p",null,"We will be using these keys for signing transactions and as the controller of Subnets."),(0,o.kt)("h2",{id:"setting-up-nodejs-project"},"Setting up Node.js Project"),(0,o.kt)("p",null,"Make a new folder for the Node.js project inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm-demo")," directory, so that, the project structure would look like this."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$HOME\n|_subnet-evm-demo\n    |_luxd\n    |_subnet-evm\n    |_lux-network-runner\n    |_subnet-evm-js\n")),(0,o.kt)("p",null,"There is no hard and fast rule to have the same project structre as demonstrated above. You can clone these repositories anywhere you want. You just have to run the commands accordingly to build binaries, copy VMs to ",(0,o.kt)("inlineCode",{parentName:"p"},"luxd/build/plugins/"),", run lux network runner with the luxd's binary etc."),(0,o.kt)("h3",{id:"installing-dependencies"},"Installing dependencies"),(0,o.kt)("p",null,"Here, ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm-js")," is our node.js project folder. Move to the project directory and install the following dependencies."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"lux (3.13.3 or above)"),(0,o.kt)("li",{parentName:"ul"},"dotenv"),(0,o.kt)("li",{parentName:"ul"},"yargs")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm install --save lux dotenv yargs\n")),(0,o.kt)("h3",{id:"configuration-and-other-details"},"Configuration and other details"),(0,o.kt)("p",null,"Make a ",(0,o.kt)("inlineCode",{parentName:"p"},"config.js")," file and store the following information, about the node and its respective URI."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'require("dotenv").config()\n\nmodule.exports = {\n  protocol: "http",\n  ip: "0.0.0.0",\n  port: 14760,\n  networkID: 1337,\n  privKey: process.env.PRIVATEKEY,\n}\n')),(0,o.kt)("p",null,"We have ",(0,o.kt)("inlineCode",{parentName:"p"},"networkID: 1337")," for the local network. Mainnet has ",(0,o.kt)("inlineCode",{parentName:"p"},"43114"),", and Fuji has ",(0,o.kt)("inlineCode",{parentName:"p"},"43113"),". Put the port here, that you have copied earlier from the ANR's output. Rest all should remain the same. Here we are also accessing ",(0,o.kt)("inlineCode",{parentName:"p"},"PRIVATEKEY")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file. So make sure to include your funded private key in the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file which was provided by ANR."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-env"},'PRIVATEKEY="PrivateKey-ewoqjP7PxY4yr3iLTpLisriqt94hdyDFNgchSxGGztUrTXtNN"\n')),(0,o.kt)("p",null,"Always put secret information like the ",(0,o.kt)("inlineCode",{parentName:"p"},".env")," file restricted to yourself only and refrain from committing it to git by including it in the ",(0,o.kt)("inlineCode",{parentName:"p"},".gitignore")," file."),(0,o.kt)("h3",{id:"import-libraries-and-setup-instances-for-lux-apis"},"Import Libraries and Setup Instances for Lux APIs"),(0,o.kt)("p",null,"This code will serve as the helper function for all other functions spread over different files. It will instantiate all the necessary Lux APIs using LuxJS and export them for other files to use it. Other files can simply import and re-use. Make a new file ",(0,o.kt)("inlineCode",{parentName:"p"},"importAPI.js")," and paste the following code inside it."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const { Lux, BinTools, BN } = require("lux")\n\n// Importing node details and Private key from the config file.\nconst { ip, port, protocol, networkID, privKey } = require("./config.js")\n\n// For encoding and decoding to CB58 and buffers.\nconst bintools = BinTools.getInstance()\n\n// Lux instance\nconst lux = new Lux(ip, port, protocol, networkID)\n\n// Platform and Info API\nconst platform = lux.PChain()\nconst info = lux.Info()\n\n// Keychain for signing transactions\nconst pKeyChain = platform.keyChain()\npKeyChain.importKey(privKey)\nconst pAddressStrings = pKeyChain.getAddressStrings()\n\n// UTXOs for spending unspent outputs\nconst utxoSet = async () => {\n  const platformUTXOs = await platform.getUTXOs(pAddressStrings)\n  return platformUTXOs.utxos\n}\n\n// Exporting these for other files to use\nmodule.exports = {\n  platform,\n  info,\n  pKeyChain,\n  pAddressStrings,\n  bintools,\n  utxoSet,\n  BN,\n}\n')),(0,o.kt)("h3",{id:"genesis-data"},"Genesis Data"),(0,o.kt)("p",null,"Each blockchain has some genesis state when it\u2019s created. Each VM defines the format and semantics of its genesis data. We will be using the default genesis data provided by ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm"),". You can also find it inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"networks/11111/")," folder of the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm")," repo or simply copy and paste the following data inside the ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis.json")," file of the project folder. (Note that fields ",(0,o.kt)("inlineCode",{parentName:"p"},"airdropHash")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"airdropAmount")," have been removed.)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "config": {\n    "chainId": 11111,\n    "homesteadBlock": 0,\n    "eip150Block": 0,\n    "eip150Hash": "0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0",\n    "eip155Block": 0,\n    "eip158Block": 0,\n    "byzantiumBlock": 0,\n    "constantinopleBlock": 0,\n    "petersburgBlock": 0,\n    "istanbulBlock": 0,\n    "muirGlacierBlock": 0,\n    "subnetEVMTimestamp": 0,\n    "feeConfig": {\n      "gasLimit": 20000000,\n      "minBaseFee": 1000000000,\n      "targetGas": 100000000,\n      "baseFeeChangeDenominator": 48,\n      "minBlockGasCost": 0,\n      "maxBlockGasCost": 10000000,\n      "targetBlockRate": 2,\n      "blockGasCostStep": 500000\n    }\n  },\n  "alloc": {\n    "d109c2fCfc7fE7AE9ccdE37529E50772053Eb7EE": {\n      "balance": "0x52B7D2DCC80CD2E4000000"\n    }\n  },\n  "nonce": "0x0",\n  "timestamp": "0x0",\n  "extraData": "0x00",\n  "gasLimit": "0x1312D00",\n  "difficulty": "0x0",\n  "mixHash": "0x0000000000000000000000000000000000000000000000000000000000000000",\n  "coinbase": "0x0000000000000000000000000000000000000000",\n  "number": "0x0",\n  "gasUsed": "0x0",\n  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000"\n}\n')),(0,o.kt)("p",null,"This file will be responsible for setting up of origin state of the chain, like initial balance allocations of the native asset, transaction fees, restricting smart contract access, etc. You should look into 2 major parameters here in the genesis file -"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"alloc": {\n    "d109c2fCfc7fE7AE9ccdE37529E50772053Eb7EE": {\n        "balance": "0x52B7D2DCC80CD2E4000000"\n    }\n}\n')),(0,o.kt)("p",null,"Put your Ethereum derived hexadecimal address (without ",(0,o.kt)("inlineCode",{parentName:"p"},"0x"),") like what you have on the C-Chain. This address will receive the associated balance. Make sure to put your controlled address here, as without this you cannot distribute tokens to users for interacting with your chain (tokens are required for paying fees for the transactions). For development purposes, you can create a new address on MetaMask and use that here."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"chainId": 11111\n')),(0,o.kt)("p",null,"Put a unique number as chain id for your chain. Conflicting chain ids can cause problems. You can read more about all of these parameters ",(0,o.kt)("a",{parentName:"p",href:"/subnets/customize-a-subnet#genesis"},"here"),"."),(0,o.kt)("h2",{id:"creating-subnet"},"Creating Subnet"),(0,o.kt)("p",null,"Let's make a file for creating a new Subnet by issuing ",(0,o.kt)("inlineCode",{parentName:"p"},"buildCreateSubnetTx")," on LuxJS' ",(0,o.kt)("inlineCode",{parentName:"p"},"platform")," API. Two of the interesting arguments of this function are ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-owner")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"threshold"),"."),(0,o.kt)("p",null,"Subnet owners control the Subnets by creating signed transactions for adding validators, creating new chains, etc. Whereas the threshold defines the minimum signature required for approving on behalf of all Subnet owners. By default it is 1, so will not pass any argument for that, as we have only one Subnet owner. Code is well commented for you to understand."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const {\n  platform,\n  pKeyChain,\n  pAddressStrings,\n  utxoSet,\n} = require("./importAPI.js")\n\nasync function createSubnet() {\n  // Creating unsgined tx\n  const unsignedTx = await platform.buildCreateSubnetTx(\n    await utxoSet(), // set of utxos this tx will consume\n    pAddressStrings, // from\n    pAddressStrings, // change address\n    pAddressStrings // Subnet owners\' address array\n  )\n\n  // signing unsgined tx with pKeyChain\n  const tx = unsignedTx.sign(pKeyChain)\n\n  // issuing tx\n  const txId = await platform.issueTx(tx)\n  console.log("Tx ID: ", txId)\n}\n\ncreateSubnet()\n')),(0,o.kt)("p",null,"Make sure to keep the ",(0,o.kt)("inlineCode",{parentName:"p"},"txID")," you received for this transaction. Once this transaction is accepted, a new Subnet with the same ID will be created. You can run this program now with the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"node createSubnet.js\n")),(0,o.kt)("h2",{id:"adding-subnet-validator"},"Adding Subnet Validator"),(0,o.kt)("p",null,"The newly created Subnet requires validators to validate the transactions on the Subnet's every blockchain. Now we will write the code in ",(0,o.kt)("inlineCode",{parentName:"p"},"addSubnetValidator.js")," to add validators to the Subnet. Only transactions signed by the threshold (here 1) number of Subnet owners will be accepted to add validators. The Subnet owners which will sign this transaction is passed as the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnetAuth")," parameter. It is an array of indices, representing the Subnet owners from the array of addresses that we passed earlier in the ",(0,o.kt)("inlineCode",{parentName:"p"},"createSubnetTx()"),"."),(0,o.kt)("p",null,"The arguments for the LuxJS API call for ",(0,o.kt)("inlineCode",{parentName:"p"},"buildAddSubnetValidatorTx()")," is explained with the help of comments. All the transaction calls of LuxJS starting with ",(0,o.kt)("inlineCode",{parentName:"p"},"build")," will return an unsigned transaction. We then have to sign it with our key chain and issue the signed transaction to the network."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const args = require("yargs").argv\nconst {\n  platform,\n  info,\n  pKeyChain,\n  pAddressStrings,\n  utxoSet,\n  BN,\n} = require("./importAPI.js")\n\nasync function addSubnetValidator() {\n  let {\n    nodeID = await info.getNodeID(),\n    startTime,\n    endTime,\n    weight = 20,\n    subnetID,\n  } = args\n\n  const pAddresses = pKeyChain.getAddresses()\n\n  // Creating Subnet auth\n  const subnetAuth = [[0, pAddresses[0]]]\n\n  // Creating unsgined tx\n  const unsignedTx = await platform.buildAddSubnetValidatorTx(\n    await utxoSet(), // set of utxos this tx will consume\n    pAddressStrings, // from\n    pAddressStrings, // change\n    nodeID, // node id of the validator\n    new BN(startTime), // timestamp after which validation starts\n    new BN(endTime), // timestamp after which validation ends\n    new BN(weight), // weight of the validator\n    subnetID, // Subnet id for validation\n    undefined, // memo\n    undefined, // asOf\n    subnetAuth // Subnet owners\' address indices signing this tx\n  )\n\n  // signing unsgined tx with pKeyChain\n  const tx = unsignedTx.sign(pKeyChain)\n\n  // issuing tx\n  const txId = await platform.issueTx(tx)\n  console.log("Tx ID: ", txId)\n}\n\naddSubnetValidator()\n')),(0,o.kt)("p",null,"We have to pass command-line arguments like ",(0,o.kt)("inlineCode",{parentName:"p"},"nodeID"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"startTime"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"endTime"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"weight")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"subnetID")," while calling the command. If we do not pass any nodeID, then by default it will use ID corresponding to the URI in the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.js")," by calling the ",(0,o.kt)("inlineCode",{parentName:"p"},"info.getNodeID()")," API from LuxJS. Similarly, the default weight will be 20, if not passed. You can run this program now with the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"node addSubnetValidator.js \\\n--subnetID <YOUR_SUBNET_ID> \\\n--startTime $(date -v +5M +%s) \\\n--endTime $(date -v +14d +%s)\n")),(0,o.kt)("p",null,"We will keep the start time 5 minutes later than the current time. This ",(0,o.kt)("inlineCode",{parentName:"p"},"$(date -v +5M +%s)")," will help to achieve the same. But you can put any timestamp in seconds there, given it is 20s later than the current time."),(0,o.kt)("h2",{id:"whitelisting-subnet-from-the-node"},"Whitelisting Subnet from the Node"),(0,o.kt)("p",null,"Subnet owners can add any node to their Subnet. That doesn't mean the nodes start validating their Subnet without any consent. If a node wants to validate the newly added Subnet, then it must restart its ",(0,o.kt)("inlineCode",{parentName:"p"},"luxd")," binary with the new Subnet being whitelisted."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'lux-network-runner control restart-node \\\n--request-timeout=3m \\\n--endpoint="0.0.0.0:8080" \\\n--node-name node1 \\\n--luxd-path ${HOME}/subnet-evm-demo/luxd/build/luxd \\\n--whitelisted-subnets="<SUBNET_ID>"\n')),(0,o.kt)("p",null,"Once the node has restarted, it will again be re-assigned to a random API port. We have to update the ",(0,o.kt)("inlineCode",{parentName:"p"},"config.js")," file with the new port."),(0,o.kt)("h2",{id:"creating-blockchain"},"Creating Blockchain"),(0,o.kt)("p",null,"Once the Subnet setup is complete, Subnet owners can deploy any number of blockchains by building their own VMs or reusing the existing ones. If the VM for the new blockchain is not being used by the Subnet validators, then each node has to place the new VM binary in their ",(0,o.kt)("inlineCode",{parentName:"p"},"luxd/build/plugins/")," folder."),(0,o.kt)("p",null,"Let's write functions to build a new blockchain using the already created ",(0,o.kt)("inlineCode",{parentName:"p"},"genesis.json")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm")," as a blueprint (VM) for this chain. We will write the code in steps. Go through the steps by understanding each function and pasting it in your ",(0,o.kt)("inlineCode",{parentName:"p"},"createBlockchain.js")," file."),(0,o.kt)("h3",{id:"importing-dependencies"},"Importing Dependencies"),(0,o.kt)("p",null,"Let's import the dependencies by using the following snippet. We are importing ",(0,o.kt)("inlineCode",{parentName:"p"},"yargs")," for reading command-line flags."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'const args = require("yargs").argv\n\nconst genesisJSON = require("./genesis.json")\nconst {\n  platform,\n  pKeyChain,\n  pAddressStrings,\n  bintools,\n  utxoSet,\n} = require("./importAPI")\n')),(0,o.kt)("h3",{id:"decoding-cb58-vmid-to-string"},"Decoding CB58 ",(0,o.kt)("inlineCode",{parentName:"h3"},"vmID")," to String"),(0,o.kt)("p",null,"We have used the utility function for decoding ",(0,o.kt)("inlineCode",{parentName:"p"},"vmName")," from the ",(0,o.kt)("inlineCode",{parentName:"p"},"vmID"),". vmID is zero-extended in a 32-byte array and encoded in CB58 from a string. Paste the function shown below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Returns string representing vmName of the provided vmID\nfunction convertCB58ToString(cb58Str) {\n  const buff = bintools.cb58Decode(cb58Str)\n  return buff.toString()\n}\n")),(0,o.kt)("h3",{id:"creating-blockchain-1"},"Creating Blockchain"),(0,o.kt)("p",null,"Now we will work upon the ",(0,o.kt)("inlineCode",{parentName:"p"},"createBlockchain()")," function. This function takes 3-4 command line flags as its input. The user must provide ",(0,o.kt)("inlineCode",{parentName:"p"},"subnetID")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"chainName")," flag. The 3rd argument could be either ",(0,o.kt)("inlineCode",{parentName:"p"},"vmID")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"vmName"),". Either one of them must be provided with the flags. Chain name is the name of blockchain you want to create with the provided ",(0,o.kt)("inlineCode",{parentName:"p"},"vmID")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"vmName"),". The ",(0,o.kt)("inlineCode",{parentName:"p"},"vmID")," must be the same as what we have created the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm")," binary with."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'// Creating blockchain with the subnetID, chain name and vmID (CB58 encoded VM name)\nasync function createBlockchain() {\n  const { subnetID, chainName } = args\n\n  // Generating vmName if only vmID is provied, else assigning args.vmID\n  const vmName =\n    typeof args.vmName !== "undefined"\n      ? args.vmName\n      : convertCB58ToString(args.vmID)\n\n  // Getting CB58 encoded bytes of genesis\n  genesisBytes = JSON.stringify(genesisJSON)\n\n  const pAddresses = pKeyChain.getAddresses()\n\n  // Creating Subnet auth\n  const subnetAuth = [[0, pAddresses[0]]]\n\n  // Creating unsgined tx\n  const unsignedTx = await platform.buildCreateChainTx(\n    await utxoSet(), // set of utxos this tx is consuming\n    pAddressStrings, // from\n    pAddressStrings, // change\n    subnetID, // id of Subnet on which chain is being created\n    chainName, // Name of blockchain\n    vmName, // Name of the VM this chain is referencing\n    [], // Array of feature extensions\n    genesisBytes, // Stringified geneis JSON file\n    undefined, // memo\n    undefined, // asOf\n    subnetAuth // Subnet owners\' address indices signing this tx\n  )\n\n  // signing unsgined tx with pKeyChain\n  const tx = unsignedTx.sign(pKeyChain)\n\n  // issuing tx\n  const txId = await platform.issueTx(tx)\n  console.log("Create chain transaction ID: ", txId)\n}\n')),(0,o.kt)("p",null,"The code above is self-explanatory -"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Processing command-line flags to constants - ",(0,o.kt)("inlineCode",{parentName:"li"},"subnetID"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"chainName")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"vmID"),"."),(0,o.kt)("li",{parentName:"ul"},"Building stringified JSON from genesis.json"),(0,o.kt)("li",{parentName:"ul"},"Creating Subnet auth array."),(0,o.kt)("li",{parentName:"ul"},"Creating unsigned tx by calling ",(0,o.kt)("inlineCode",{parentName:"li"},"platform.buildCreateChainTx"),"."),(0,o.kt)("li",{parentName:"ul"},"Signing and issuing the signed tx.")),(0,o.kt)("p",null,"Make sure to keep txID received by running this code. Once the transaction is committed, the txID will be the ",(0,o.kt)("inlineCode",{parentName:"p"},"blockchainID")," or identifier for the newly created chain. You can run this program now with the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"node createBlockchain.js \\\n--subnetID <YOUR_SUBNET_ID> \\\n--chainName <CUSTOM_CHAIN_NAME> \\\n--vmName subnetevm\n")),(0,o.kt)("p",null,"Creating a new chain will take few seconds. You can also view the logs on the Lux Network Runner tab of the terminal."),(0,o.kt)("h2",{id:"interacting-with-the-new-blockchain-with-metamask"},"Interacting with the New Blockchain with MetaMask"),(0,o.kt)("p",null,"We have created the new Subnet, deployed a new blockchain using the ",(0,o.kt)("inlineCode",{parentName:"p"},"subnet-evm"),", and finally added a validator to this Subnet, for validating different chains. Now it's time to interact with the new chain. You can follow this ",(0,o.kt)("a",{parentName:"p",href:"/subnets/create-a-fuji-subnet#interact-with-the-new-blockchain"},"part")," in our docs, to learn, how you can set up your MetaMask to interact with this chain. You can send tokens, create smart contracts, and do everything that you can do on C-Chain."))}h.isMDXComponent=!0}}]);